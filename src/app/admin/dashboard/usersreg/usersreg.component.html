<div class="p-4">
  <h2 class="text-2xl font-bold mb-4 text-purple-700">Registered Users</h2>

  <div *ngIf="loading" class="text-center text-gray-500">Loading users...</div>
  <div *ngIf="errorMessage" class="text-red-600">{{ errorMessage }}</div>

  <table *ngIf="!loading && users.length > 0" class="min-w-full bg-white border border-gray-200">
    <thead class="bg-gray-100 text-left text-gray-600 uppercase text-sm font-semibold">
      <tr>
        <th class="py-2 px-4 border-b">#</th>
        <th class="py-2 px-4 border-b">Username</th>
        <th class="py-2 px-4 border-b">Email</th>
        <th class="py-2 px-4 border-b">Phone</th>
        <th class="py-2 px-4 border-b">SubCounty</th>
        <th class="py-2 px-4 border-b">Ward</th>
        <th class="py-2 px-4 border-b">Role</th>
        <th class="py-2 px-4 border-b">Actions</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let user of users; let i = index" class="hover:bg-gray-50">
        <td class="py-2 px-4 border-b">{{ i + 1 }}</td>

        <td class="py-2 px-4 border-b">
          <span *ngIf="editUser?.email !== user.email">{{ user.username }}</span>
          <input
            *ngIf="editUser?.email === user.email"
            type="text"
            [(ngModel)]="editUser.username"
            class="border p-1 rounded w-full"
          />
        </td>

        <td class="py-2 px-4 border-b">{{ user.email }}</td>

        <td class="py-2 px-4 border-b">
          <span *ngIf="editUser?.email !== user.email">{{ user.phone_no }}</span>
          <input
            *ngIf="editUser?.email === user.email"
            type="text"
            [(ngModel)]="editUser.phone_no"
            class="border p-1 rounded w-full"
          />
        </td>

        <td class="py-2 px-4 border-b">
          <span *ngIf="editUser?.email !== user.email">{{ user.subCounty }}</span>
          <input
            *ngIf="editUser?.email === user.email"
            type="text"
            [(ngModel)]="editUser.subCounty"
            class="border p-1 rounded w-full"
          />
        </td>

        <td class="py-2 px-4 border-b">
          <span *ngIf="editUser?.email !== user.email">{{ user.ward }}</span>
          <input
            *ngIf="editUser?.email === user.email"
            type="text"
            [(ngModel)]="editUser.ward"
            class="border p-1 rounded w-full"
          />
        </td>

        <td class="py-2 px-4 border-b capitalize">
          <span *ngIf="editUser?.email !== user.email">{{ user.role }}</span>
          <select
            *ngIf="editUser?.email === user.email"
            [(ngModel)]="editUser.role"
            class="border p-1 rounded w-full"
          >
            <option value="user">User</option>
            <option value="admin">Admin</option>
          </select>
        </td>

        <td class="py-2 px-4 border-b">
          <div *ngIf="editUser?.email !== user.email">
            <button
              (click)="startEdit(user)"
              class="bg-blue-500 text-white px-3 py-1 rounded mr-2 hover:bg-blue-600"
            >
              Edit
            </button>
            <button
              (click)="deleteUser(user.email)"
              class="bg-red-500 text-white px-3 py-1 rounded hover:bg-red-600"
            >
              Delete
            </button>
          </div>

          <div *ngIf="editUser?.email === user.email">
            <button
              (click)="saveEdit()"
              class="bg-green-500 text-white px-3 py-1 rounded mr-2 hover:bg-green-600"
            >
              Save
            </button>
            <button
              (click)="cancelEdit()"
              class="bg-gray-400 text-white px-3 py-1 rounded hover:bg-gray-500"
            >
              Cancel
            </button>
          </div>
        </td>
      </tr>
    </tbody>
  </table>

  <div *ngIf="!loading && users.length === 0" class="text-gray-500">No users found.</div>
</div>
